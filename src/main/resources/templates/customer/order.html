<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>New Order | Mr. Daebak Dinner</title>
    <link rel="stylesheet" th:href="@{/CSS/customer-order.css}">
</head>
<body>

<header class="navbar">
    <div class="navbar-left">
        <a href="/" class="logo">MR.DAEBAKDINNER</a>
    </div>
    <nav class="navbar-center">
        <a href="#">SIGNUP</a>
        <a href="#">ABOUT US</a>
        <a href="#">MENU</a>
        <a href="#">DELIVERY</a>
    </nav>
    <div class="navbar-right">
        <a href="/customer/logout" class="logout-btn">로그아웃</a>
        <a href="#" class="mypg-btn">마이페이지</a>
    </div>
</header>

<main class="order-main">
    <h1 class="page-title">NEW ORDER</h1>
    <p class="page-subtitle">메뉴와 서빙 스타일을 선택하고 배달 정보를 입력한 뒤 제출하세요.</p>

    <form id="orderForm" th:action="@{/customer/orders/new}" method="post" autocomplete="off" novalidate class="order-form-container">

        <select id="menuSelect" name="dinnerKind" required class="hidden-select">
            <option value="" selected hidden>메뉴를 선택하세요</option>
            <option value="VALENTINE">Valentine dinner</option>
            <option value="FRENCH">French dinner</option>
            <option value="ENGLISH">English dinner</option>
            <option value="CHAMPAGNE">Champagne Feast dinner</option>
        </select>

        <div class="top-selection-row">
            <div class="menu-area">
                <h2 class="selection-heading">1. 디너 종류 선택</h2>
                <div class="menu-card-container">
                    <div class="menu-card" data-menu-value="VALENTINE">
                        <img th:src="@{/images/Valentine_Dinner.png}" alt="Valentine dinner" class="menu-image">
                        <div class="card-info">
                            <h3>VALENTINE</h3>
                            <p>로맨틱한 밤을 위한 스페셜 디너 세트</p>
                        </div>
                    </div>
                    <div class="menu-card" data-menu-value="FRENCH">
                        <img th:src="@{/images/French_Dinner.png}" alt="French dinner" class="menu-image">
                        <div class="card-info">
                            <h3>FRENCH</h3>
                            <p>클래식하고 우아한 정통 프랑스 코스</p>
                        </div>
                    </div>
                    <div class="menu-card" data-menu-value="ENGLISH">
                        <img th:src="@{/images/English_Dinner.png}" alt="English dinner" class="menu-image">
                        <div class="card-info">
                            <h3>ENGLISH</h3>
                            <p>따뜻하고 풍성한 브런치 스타일의 디너</p>
                        </div>
                    </div>
                    <div class="menu-card" data-menu-value="CHAMPAGNE">
                        <img th:src="@{/images/Champagne_Dinner.png}" alt="Champagne Feast dinner" class="menu-image">
                        <div class="card-info">
                            <h3>CHAMPAGNE</h3>
                            <p>샴페인과 함께하는 화려한 파티 만찬</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="style-area">
                <h2 class="selection-heading">2. 서빙 스타일 선택</h2>
                <div class="style-select-wrapper">
                    <select id="styleSelect" name="dinnerStyle" required>
                        <option value="" selected hidden>스타일을 선택하세요</option>
                        <option value="SIMPLE">Simple</option>
                        <option value="GRAND">Grand</option>
                        <option value="DELUX">Delux</option>
                    </select>
                </div>
            </div>
        </div>

        <fieldset class="order-items-fieldset">
            <legend class="fieldset-legend">3. 주문 구성 (옵션 설정)</legend>
            <div class="item-list-grid">
                <div class="item-group">
                    <label for="wine">와인 (43,000)</label>
                    <input type="number" id="wine" name="orderItems[wine]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="steak">스테이크 (39,000)</label>
                    <input type="number" id="steak" name="orderItems[steak]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="coffee_cup">커피 (컵) (6,000)</label>
                    <input type="number" id="coffee_cup" name="orderItems[coffee_cup]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="coffee_pot">커피 (포트) (36,000)</label>
                    <input type="number" id="coffee_pot" name="orderItems[coffee_pot]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="salad">샐러드 (23,000)</label>
                    <input type="number" id="salad" name="orderItems[salad]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="eggscramble">스크램블 에그 (16,000)</label>
                    <input type="number" id="eggscramble" name="orderItems[eggscramble]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="bacon">베이컨 (10,000)</label>
                    <input type="number" id="bacon" name="orderItems[bacon]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="bread">빵 (7,000)</label>
                    <input type="number" id="bread" name="orderItems[bread]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="baguette">바게트 (8,000)</label>
                    <input type="number" id="baguette" name="orderItems[baguette]" min="0" value="0">
                </div>
                <div class="item-group">
                    <label for="champagne">샴페인 (98,000)</label>
                    <input type="number" id="champagne" name="orderItems[champagne]" min="0" value="0">
                </div>
            </div>
        </fieldset>

        <section class="delivery-payment-info">
            <h2 class="selection-heading full-width-heading">4. 배달 및 결제 정보</h2>

            <div class="form-group">
                <label for="deliveryAddress">배달 주소</label>
                <input type="text" id="deliveryAddress" name="deliveryAddress" required/>
            </div>

            <div class="form-group">
                <label for="cardNumber">카드 번호</label>
                <input type="text" id="cardNumber" name="cardNumber" required/>
            </div>
        </section>

        <div class="form-actions">
            <button type="reset" id="resetBtn" class="secondary-btn">초기화</button>
            <button type="submit" class="primary-btn">주문 제출</button>
            <a th:href="@{/customer/main}" class="tertiary-btn">이전</a>
        </div>

        <div th:if="${orderErrorMessage}" class="error-message">
            <p th:utext="${orderErrorMessage}"></p>
        </div>
        <div th:if="${itemErrorMessage}" class="error-message">
            <p th:utext="${itemErrorMessage}"></p>
            <ul>
                <li th:each="item : ${insufficientItems}" th:text="${item}"></li>
            </ul>
        </div>
    </form>
</main>

</body>
</html>

<script>
    (function(){
        const menuSelect = document.getElementById('menuSelect');
        const styleSelect = document.getElementById('styleSelect');
        const resetBtn = document.getElementById('resetBtn');
        const menuCards = document.querySelectorAll('.menu-card'); // class = menu-card인 모든 요소 저장

        // 아이템 input들을 객체로 캐싱
        const items = {
            wine: document.getElementById('wine'),
            steak: document.getElementById('steak'),
            coffee_cup: document.getElementById('coffee_cup'),
            coffee_pot: document.getElementById('coffee_pot'),
            salad: document.getElementById('salad'),
            eggscramble: document.getElementById('eggscramble'),
            bacon: document.getElementById('bacon'),
            bread: document.getElementById('bread'),
            baguette: document.getElementById('baguette'),
            champagne: document.getElementById('champagne')
        };

        // 모든 아이템 수량 0으로 초기화
        function resetItems() {
            Object.values(items).forEach(input => input.value = 0);
        }

        // 메뉴 선택 시 스타일/아이템 초기화 및 기본값 반영 로직
        function updateMenuSelection(selectedValue) {
            // 1. 모든 아이템 수량 초기화 (가장 중요한 요구사항)
            resetItems();

            // 2. 스타일 옵션과 값 초기화 (가장 중요한 요구사항)
            Array.from(styleSelect.options).forEach(opt => opt.disabled = false); // 모든 스타일 활성화
            styleSelect.value = ''; // 스타일 선택 값 초기화

            // 3. 메뉴별 기본 아이템 값 설정
            switch(selectedValue){
                case 'VALENTINE':
                    items.wine.value = 1;
                    items.steak.value = 1;
                    break;
                case 'FRENCH':
                    items.coffee_cup.value = 1;
                    items.wine.value = 1;
                    items.salad.value = 1;
                    items.steak.value = 1;
                    break;
                case 'ENGLISH':
                    items.eggscramble.value = 1;
                    items.bacon.value = 1;
                    items.bread.value = 1;
                    items.steak.value = 1;
                    break;
                case 'CHAMPAGNE':
                    items.champagne.value = 1;
                    items.baguette.value = 4;
                    items.coffee_pot.value = 1;
                    items.wine.value = 1;
                    items.steak.value = 1;

                    // CHAMPAGNE 메뉴의 특수 로직: SIMPLE 스타일 비활성화
                    Array.from(styleSelect.options).forEach(opt => {
                        if(opt.value === 'SIMPLE'){
                            opt.disabled = true;
                        }
                    });
                    break;
            }
        }

        // --- 메뉴 카드 클릭 이벤트 핸들러 ---
        menuCards.forEach(card => {
            card.addEventListener('click', () => {
                const menuValue = card.getAttribute('data-menu-value');

                // 1. 시각적 활성화/비활성화
                menuCards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');

                // 2. 숨겨진 <select> 값 업데이트 (폼 제출을 위해 필수)
                menuSelect.value = menuValue;

                // 3. 아이템/스타일 초기화 및 기본값 설정 로직 실행
                updateMenuSelection(menuValue);
            });
        });

        // reset 시 옵션과 아이템 재설정
        resetBtn.addEventListener('click', () => {
            resetItems();
            Array.from(styleSelect.options).forEach(opt => opt.disabled = false);
            styleSelect.value = '';
            menuSelect.value = '';

            // 초기화 시 카드 선택 표시 제거
            menuCards.forEach(c => c.classList.remove('selected'));
        });
    })();
</script>